%h1 Payments Summary

- if can? :new, :payment_adjustment
  = link_to "Create Adjustment Payment", new_payment_adjustment_path
  %br
- if can? :list, :payment_adjustment
  = link_to "View list of Payments/Refunds", list_payment_adjustments_path
%br
%Br


- cache [Payment] do
  %table
    %caption Payments Summary
    %thead
      %tr
        %th Total Amount Received
    %tbody
      %tr
        %td= print_formatted_currency(Payment.total_received)

%hr
%h2 Expenses by Group

%table.sortable
  %thead
    %tr
      %th Group
      %th Entry
      %th Num paid (no discount)
      %th Num paid (with discount or free)
      %th Total Amount Paid
      %th Num unpaid
  %tbody
    - @expense_items.each do |item|
      %tr
        %td= item.expense_group
        %td= link_to item, details_expense_item_path(item)
        - cache [PaymentDetail.cache_key_for_set(item.id), RegistrantExpenseItem.cache_key_for_set(item.id) ] do
          %td
            = item.num_paid_without_coupon
          %td
            = item.num_paid_with_coupon + item.num_free
          %td
            = print_formatted_currency(item.total_amount_paid)
          %td
            - unpaid_count = item.num_unpaid
            = unpaid_count
