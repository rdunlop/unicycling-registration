<%= form_for(setup_registrant_choices(@registrant)) do |f| %>
  <% if @registrant.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@registrant.errors.count, "error") %> prohibited this registrant from being saved:</h2>

      <ul>
        <% @registrant.errors.each do |attribute,error_message| %>
          <% next if attribute == :gender_male %>
          <% next if attribute == :gender_female %>
          <% next if "#{attribute}" == "registrant_event_sign_ups.signed_up" %>
          <% next if "#{attribute}" == "registrant_event_sign_ups.event_category_id" %>
          <% if "#{attribute}" == "registrant_event_sign_ups.base" %>
            <li><%= error_message %></li>
          <% else %>
            <li><%= @registrant.errors.full_message(attribute, error_message )%></li>
          <% end %>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="data_block">
    <%= f.hidden_field :competitor %>
    <h2><%= @registrant.competitor ? t(".competitor") : t(".noncompetitor") %></h2>
    <% unless @registrant.new_record? %>
      <div class="delete_link">
        <% if can? :destroy, @registrant %>
          <%= link_to t('.delete'), registrant_path(@registrant), data: { confirm: "Are you sure you want to delete this registration" }, :method => :delete %>
        <% end %>
      </div>
    <% end %>
    <div class="required"><%= t(".required_fields") %></div>
    <fieldset class="data_block">
      <legend><%= t(".base_details") %></legend>
      <span>
        <%= render :partial => "/registrants/name", :locals => {:f => f } %>
      </span>
      <span>
        <%= f.label :birthday, t(".birthday"), :class => "required" %>
        <%= f.date_select :birthday, {:start_year => 1920, :end_year => Time.now.year, :include_blank => true } %>
      </span>
      <span>
        <%= f.label :gender_male, t('.male'), :class => "required" %>
        <%= f.radio_button :gender, 'Male' %>
        <%= f.label :gender_female, t('.female'), :class => "required" %>
        <%= f.radio_button :gender, 'Female' %>
      </span>
      <%= f.fields_for :contact_detail do |cd| %>
        <span>
          <%= cd.label :club, t(".primary_team_or_club_name") %>
          <%= cd.text_field :club %><br />
          <%= cd.label :club_contact, t(".primary_team_or_club_contact") %>
          <%= cd.text_field :club_contact, :size => 25  %>
        </span>
        <% if @config.usa %>
          <span>
            <%= cd.label :usa_member_number, "USA Membership Number" %>
            <%= cd.text_field :usa_member_number, :size => 5, :class => "ui-tooltip", :title => "A USA membership is required to participate at #{@config.short_name}" %><br />
          </span>
        <% end %>
      <% end %>
      <span>
        <%= f.label :volunteer, t(".i_am_interested_in_volunteering") %>
        <%= f.check_box :volunteer, :title => t(".i_accept_to_be_contacted") %>
      </span>
    </fieldset>
    <%= render :partial => "registration_periods/list", :locals => {:competitor => @registrant.competitor } %>

    <% unless @categories.nil? %>
      <%= render :partial => "/attending/events", :locals => {:registrant => @registrant, :categories => @categories, :f => f } %>
    <% end %>

    <div class="data_block">
      <%= render :partial => "contact_detail", :locals => { :reg_f => f, :other_registrant => @other_registrant } %>
    </div>

    <% if @has_online_waiver %>
      <br \>
      <div class="data_block" style="margin-top:20px;">
        <%= render :partial => "online_waiver", :locals => {:f => f, :registrant => @registrant } %>
      </div>
    <% end %>

  </div>
  <div class="actions">
    <% if @registrant.competitor %>
      <%= f.submit t('.continue'), :class => "competitor registration_button" %>
    <% else %>
      <%= f.submit t('.continue'), :class => "noncompetitor registration_button" %>
    <% end %>
  </div>
<% end %>
